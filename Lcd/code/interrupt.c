// Includes --------------------------------------------------------------------
#include "settings.h"
#include <avr/io.h>         // Заголовочный файл для работы с РВВ МК
#include <avr/interrupt.h>  // Заголовочный файл для работы с прерываниями МК

#include "main.h"
#include "lcd16x2.h"  // Заголовочный файл для работы с дисплеем LCD16x2

// Handlers --------------------------------------------------------------------
/*******************************************************************************
Timer2 Overflow Handler
Используется для обработки нажатия кнопок
*******************************************************************************/
ISR(TIMER2_OVF_vect)
{
    // Если нажата кнопка PA5, то переключаем состояние дисплея вкл/выкл;
    // иначе, сбрасываем флаг нажатия кнопки
    if (!(PINA & (1 << PINA5)))
    {
        // Если флаг btnOn установлен, то кнопка не отжата, пропускаем обработку
        if (!flag.btnOn)
        {
            flag.btnOn = 1;

            // Если флаг lcdOn установлен, то сбрасываем lcdOn и выключаем дисплей;
            // иначе устанавливаем lcdOn и включаем дисплей
            if (flag.lcdOn)
            {
                flag.lcdOn = 0;
                LcdSendCmd(1 << LCD_ON);
            }
            else
            {
                flag.lcdOn = 1;
                LcdSendCmd((1 << LCD_ON) | (1 << LCD_ON_D));
            }
        }
    }
    else
    {
        flag.btnOn = 0;
    }
}

/*******************************************************************************
USART RX Complete Handler
Используется для приема пакета данных
*******************************************************************************/
ISR(USART_RXC_vect)
{
    ;
}
// End File --------------------------------------------------------------------